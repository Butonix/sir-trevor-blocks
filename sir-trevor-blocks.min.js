!function(){var t={en:{blocks:{button:{title:"Button",controls:{action:"Action",dimensions:"Dimensions",border:"Border",font:"Font",width:"Width",height:"Height",radius:"Radius",size:"Size",type:"Type",background:"Background",color:"Color",align:"Align",center:"Center",left:"Left",right:"Right"},hint:{text:"¡Escribe aqui el texto de tu Boton!",href:"Write an email, phone number or web URL here"},accept:"Accept",cancel:"Cancel"},image_edit:{finish:"Confirm the crop for being able to save"},map:{title:"Map",hint:"Write an address here"},spacer:{title:"Spacer"},widget:{title:"Widget",hint:"Paste your external Widget html here",edit:"Double click for edit"},ck_editor:{title:"Text"}}}};jQuery.extend(!0,SirTrevor.Locales,t)}(),function(){var t={es:{blocks:{button:{title:"Botón",controls:{action:"Acción",dimensions:"Dimensiones",border:"Borde",font:"Fuente",width:"Ancho",height:"Alto",radius:"Radio",size:"Tamaño",type:"Tipo",background:"Fondo",color:"Color",align:"Alineado",center:"Centro",left:"Izquierda",right:"Derecha"},hint:{text:"¡Escribe aqui el texto de tu Boton!",href:"Escribe aqui un email, un telefono o una web"},accept:"Aceptar",cancel:"Cancelar"},image_edit:{finish:"Confirma el recorte de la imagen para poder guardar"},map:{title:"Mapa",hint:"Escribe una direccion aquí"},spacer:{title:"Separador"},widget:{title:"Widget",hint:"Pega el html de tu widget externo aquí",edit:"Haz doble clic para editar"},ck_editor:{title:"Texto"}}}};jQuery.extend(!0,SirTrevor.Locales,t)}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Button=SirTrevor.Block.extend({type:"button",title:function(){return i18n.t("blocks:button:title")},icon_name:"button",editorHTML:function(){return _.template('<div class="st-editor"><div class="st-preview st-margin-bottom-20"><p class="st-required st-text-block" contenteditable="true"></p></div><div class="st-row st-margin-bottom-20"><div class="st-column st-column-66 st-padding-right-25"><div class="st-control"><h4 class="st-field-name"><%= i18n.t("blocks:button:controls:action") %></h4><div class="st-input-container st-input-container-resert"> <input name="href" type="hidden"> <input class="st-input-long" name="user-href" type="text"></div></div></div><div class="st-column st-column-33 st-padding-left-25"><div class="st-control"><h5 class="st-field-name st-align-name"><%= i18n.t("blocks:button:controls:align") %></h5><div class="st-input-container st-select"> <select class="st-value" name="css-float"><option value="none"><%= i18n.t("blocks:button:controls:center") %></option><option value="left"><%= i18n.t("blocks:button:controls:left") %></option><option value="right"><%= i18n.t("blocks:button:controls:right") %></option></select></div></div></div></div><div class="st-row"><div class="st-column st-column-33 st-padding-right-25"><h4><%= i18n.t("blocks:button:controls:dimensions") %></h4><div class="st-control"><h5 class="st-field-name"><%= i18n.t("blocks:button:controls:width") %></h5><div class="st-input-container"> <input class="st-value" name="css-width" type="range" value="100" units="%" step="1" max="100" min="10"></div></div><div class="st-control"><h5 class="st-field-name"><%= i18n.t("blocks:button:controls:height") %></h5><div class="st-input-container"> <input class="st-value" name="css-padding" type="range" value="1" units="em 0" step="0.1" max="5" min="0.2"></div></div><div class="st-control"><h5 class="st-field-name"><%= i18n.t("blocks:button:controls:background") %></h5><div class="st-input-container st-color"> <input class="st-value" name="css-background-color" type="color" value="#00CA6B"></div></div></div><div class="st-column st-column-33 st-padding-sides-25"><h4><%= i18n.t("blocks:button:controls:border") %></h4><div class="st-control"><h5 class="st-field-name"><%= i18n.t("blocks:button:controls:width") %></h5><div class="st-input-container"> <input class="st-value" name="css-border-width" type="range" value="2" units="px" step="1" max="6" min="0"></div></div><div class="st-control"><h5 class="st-field-name"><%= i18n.t("blocks:button:controls:radius") %></h5><div class="st-input-container"> <input class="st-value" name="css-border-radius" type="range" value="2" units="px" step="1" max="100" min="0"></div></div><div class="st-control"><h5 class="st-field-name"><%= i18n.t("blocks:button:controls:color") %></h5><div class="st-input-container st-color"> <input class="st-value" name="css-border-color" type="color" value="#4D4D4D"></div></div></div><div class="st-column st-column-33 st-padding-left-25"><h4><%= i18n.t("blocks:button:controls:font") %></h4><div class="st-control"><h5 class="st-field-name"><%= i18n.t("blocks:button:controls:size") %></h5><div class="st-input-container"> <input class="st-value" name="css-font-size" type="range" value="2" units="em" step="0.1" max="5" min="0.2"></div></div><div class="st-control"><h5 class="st-field-name"><%= i18n.t("blocks:button:controls:type") %></h5><div class="st-input-container st-select"> <select class="st-value" name="css-font-family"><option value="sans-serif">Sans Serif</option><option value="cursive">Cursive</option><option value="fantasy">Fantasy</option><option value="serif">Serif</option><option value="monospace">Monospace</option></select></div></div><div class="st-control"><h5 class="st-field-name"><%= i18n.t("blocks:button:controls:color") %></h5><div class="st-input-container st-color"> <input class="st-value" name="css-color" type="color" value="#4D4D4D"></div></div></div></div></div>',{imports:{i18n:i18n}})},onBlockRender:function(){this.$preview=this.$el.find(".st-preview"),this.$css=this.$editor.find('[name^="css-"]'),this.$editor.find('[type="color"]').spectrum({showInput:!0,preferredFormat:"hex",showButtons:!0,chooseText:i18n.t("blocks:button:accept"),cancelText:i18n.t("blocks:button:cancel")}),$(this.getTextBlockHTML()).text().length<=0&&this.setTextBlockHTML(i18n.t("blocks:button:hint:text")),this.$editor.find('[name="user-href"]').attr("placeholder",i18n.t("blocks:button:hint:href")).on("change input",this._onHrefChange.bind(this)),this.$css.on("change input",this._onCssPropertyChange.bind(this)),this.$css.filter('[name*="color"]').on("move.spectrum",this._onCssPropertyChange.bind(this)),this.$css.trigger("change")},loadData:function(t){this.setTextBlockHTML(t.text),Object.keys(t).forEach(function(e){var i=t[e],n=this.$el.find('[name="'+e+'"]');n.attr("units")&&n.attr("units").length>0&&(i=i.replace(n.attr("units"),"")),this.$el.find('[name="'+e+'"]').val(i)}.bind(this));var e=this.$el.find(".st-preview"),i=this.$el.find(".st-row");i.hide(),e.attr("contenteditable","false"),e.click(function(){i.show(),e.attr("contenteditable","true"),e.unbind("click")})},_serializeData:function(){var t={};return this.hasTextBlock()&&(t.text=this.getTextBlockHTML(),t.format="html"),this.$("input, select").each(function(e,i){if(i.getAttribute("name")){var n=i.value;i.getAttribute("units")&&(n+=i.getAttribute("units")),t[i.getAttribute("name")]=n}}),t},_onHrefChange:function(t){var e=$(t.target),i=e.val(),n=this.$editor.find('[name="href"]');/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(i)?n.val("mailto:"+i):/^\+?[0-9\-]+$/.test(i)?n.val("tel:"+i):/^(ftp|http|https):\/\/[^ "]+$/.test(i)?n.val(i):n.val("http://"+i)},_onCssPropertyChange:function(t,e){var i=$(t.target),n=i.attr("name").replace(/^css\-/,""),o=e?e.toString():i.val();if(i.attr("st-value",o),e&&i.val(e),"range"==i.attr("type")){var s=i.next();s.css("content",o)}i.attr("units")&&i.attr("units").length>0&&(o+=i.attr("units")),n.split("_").forEach(function(t){this.$preview.css(t,o)},this)}})):console.error("SirTrevor.Blocks.Button could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?CKEDITOR?void(SirTrevor.Blocks.CkEditor=SirTrevor.Block.extend({type:"ck_editor",title:function(){return i18n.t("blocks:ck_editor:title")},icon_name:"text",editorHTML:'<textarea class="st-text-block" rows="10" cols="80"></textarea>',loadData:function(t){this.$editor.val(t.text)},onBlockRender:function(){this.config&&this.config.basePath&&(CKEDITOR.basePath=this.config.basePath),this.ckeditor=CKEDITOR.replace(this.getTextBlock()[0],{extraPlugins:"colorbutton,colordialog,font,justify",toolbarGroups:[{name:"basicstyles",groups:["basicstyles"]},{name:"links",groups:["links"]},{name:"paragraph",groups:["list","blocks","align"]},{name:"insert",groups:["Table"]},{name:"styles"},{name:"colors"}],removeButtons:"CreateDiv,Styles,Flash,Iframe,Image,HorizontalRule,Smiley,PageBreak,Anchor"}),this.loading(),this.ckeditor.on("instanceReady",function(t){this.ready()}.bind(this)),this.ckeditor.on("change",function(t){var e="blocks:ck_editor:change",i=jQuery.Event(t);i.target=this.$editor[0],this.mediator.trigger(e,i)}.bind(this)),this.$editor.parent().find(".st-block-ui-btn--reorder").hide()},_serializeData:function(){return{type:"html",text:this.ckeditor?this.ckeditor.getData():""}}})):console.error("SirTrevor.Blocks.CkEditor could not load because CKEditor wasn't found"):console.error("SirTrevor.Blocks.CkEditor could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.HeadingAlign=SirTrevor.Blocks.Heading.extend({type:"heading_align",alignable:!0})):console.error("SirTrevor.Blocks.HeaderAlign could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.ImageEdit=SirTrevor.Blocks.Image.extend({type:"image_edit",title:function(){return i18n.t("blocks:image:title")},cropTimeout:1e3,controllable:!0,controls:{save:function(){var t={name:this.filename+".png",folder:"img",base64content:this.$cropper("getCroppedCanvas").toDataURL(this.type)};this.resetErrors(),this.$editor.html($("<img>",{src:t.base64content})).show();var e=function(t){t&&void 0!==t.cause?this.setError(this.$inputs,t.cause):this.setError(this.$inputs,t)}.bind(this);$.ajax({method:"POST",url:SirTrevor.config.defaults.uploadUrl,data:t,beforeSend:function(){this.$control_ui.hide(),this.loading()}.bind(this),complete:function(){this.ready(),this.performValidations()}.bind(this)}).then(function(t){if("success"==t.result){this.setAndLoadData({file:{url:t.url}});var i="blocks:image_edit:uploaded",n=jQuery.Event(n);n.target=this.$editor.find(">img")[0],this.mediator.trigger(i,n)}else e(t)}.bind(this)).fail(e)}},validations:["_checkCropFinished"],_isImageUploaded:function(){var t=this._getData();return t&&t.file&&t.file.url.length>0?!/^data:image\/[a-z]{1,};base64/.test(t.file.url):!1},_checkCropFinished:function(){this.isEmpty()||this._isImageUploaded()||this.setError(this.$inputs,i18n.t("blocks:image_edit:finish"))},loadData:function(t){this.$editor.html($("<img>",{src:t.file.url})).show(),this.$control_ui.hide()},remove:function(){this.ajaxable&&this.resolveAllInQueue();var t=this._getData();if(this._isImageUploaded()){var e="block:image_edit:remove";this.mediator._events[e]&&this.mediator._events[e].length>0?this.mediator.trigger(e,t.file.url):$.ajax({method:"POST",url:SirTrevor.config.defaults.imageDeleteUrl,data:{url:t.file.url}})}this.$el.remove()},onBlockRender:function(){this.$dropzone.noDropArea().unbind("drop"),this.$inner.dropArea().bind("drop",this.__handleDrop.bind(this)),this.$inputs.find("button").bind("click",function(t){t.preventDefault()}),this.$inputs.find("input").on("change",function(t){this.onDrop(t.currentTarget)}.bind(this)),this.$control_ui.hide()},onDrop:function(t){var e=t.files[0],i="undefined"!=typeof URL?URL:"undefined"!=typeof webkitURL?webkitURL:null;if(/image/.test(e.type)){this.filename=e.name,this.type=e.type,this.$control_ui.show(),this.$inputs.hide(),this.$el.noDropArea(),this.$editor.html($("<img>",{src:i.createObjectURL(e)})).show(),this.loading();var n=null,o=this.$editor.find(">img");o.cropper({built:function(){this.$cropper=function(){return o.cropper.apply(o,arguments)},this.ready()}.bind(this),crop:function(t){if(n)clearTimeout(n);else{var e=jQuery.Event("crop:start");e.originalEvent=t,this.$el.triggerHandler(e,[this.$inputs.first()])}n=setTimeout(function(){n=null;var e=jQuery.Event("crop:finish");e.originalEvent=t,this.$el.triggerHandler(e,[this.$inputs.first()])}.bind(this),this.cropTimeout)}.bind(this)})}},isEmpty:function(){return this.$editor.find("img").length<=0||_.isEmpty(this._getData())},_serializeData:function(){var t=this.$editor.find("img").attr("src");return this.$cropper&&!/^http/.test(t)&&(t=this.$cropper("getCroppedCanvas").toDataURL(this.type)),t&&t.length>0?{file:{url:t}}:null},__handleDrop:function(t){t.preventDefault(),t=t.originalEvent;var e=$(t.target),i=this._toArray(t.dataTransfer.types);e.removeClass("st-dropzone--dragover"),i&&i.some(function(t){return this.valid_drop_file_types.includes(t)},this)&&this.onDrop(t.dataTransfer),SirTrevor.EventBus.trigger("block:content:dropped",this.blockID)},_toArray:function(t){if(Array.isArray(t))return t;for(var e=[],i=t.length>>>0;i--;)e[i]=t[i];return e}})):console.error("SirTrevor.Blocks.ImageEdit could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Map=SirTrevor.Block.extend({type:"map",title:function(){return i18n.t("blocks:map:title")},icon_name:"map",default_width:600,default_height:300,default_zoom:15,map_static_img:"https://maps.googleapis.com/maps/api/staticmap?size=<%= width %>x<%= height %>&center=<%= address %>&markers=|<%= address %>&zoom=<%= zoom %>&scale=2",map_link:"http://maps.google.com/maps?q=<%= address %>",editorHTML:function(){var t=$("<input>",{type:"text",name:"address",placeholder:i18n.t("blocks:map:hint")}),e=$("<input>",{type:"hidden",name:"zoom",value:this.default_zoom}),i=$("<input>",{type:"hidden",name:"width",value:this.default_width}),n=$("<input>",{type:"hidden",name:"height",value:this.default_height}),o=$("<div>",{"class":"map"}),s=$("<div>");return s.append(t),s.append(e),s.append(i),s.append(n),s.append(o),o.css({"border-radius":"5px","background-color":"#DDD","background-position":"center","background-size":"cover",height:this.default_height+"px",width:"100%"}),o.hide(),s.html()},inputTimeoutAmount:1e3,inputTimeoutId:null,onBlockRender:function(){this.$map=this.$el.find(".map"),this.$zoom=this.$el.find('[name="zoom"]');var t=function(){window.open(this._getGmapsLink())}.bind(this),e=function(t){if(this.$map.is(":hover")){t.preventDefault();var e=t.originalEvent,i=e.deltaY||e.wheelDelta;i>0?this.$zoom.val(Math.max(0,Number(this.$zoom.val())-1)):this.$zoom.val(Number(this.$zoom.val())+1),this._reloadMap()}}.bind(this);this.$editor.bind("keypress keydown keyup",function(t){13==t.keyCode&&t.preventDefault()}),this.$map.on("click",t),this.$editor.is(":visible")&&(this.$map.on("wheel mousewheel",e),this.$editor.on("keyup change",this._reloadMap.bind(this)))},loadData:function(t){Object.keys(t).forEach(function(e){this.$el.find('[name="'+e+'"]').val(t[e])}.bind(this)),this.$editor.hide(),this._reloadMap()},isEmpty:function(){return!(this.$el&&this.$el.find('[name="address"]').length>0&&this.$el.find('[name="address"]').val().length>0)},_serializeData:function(){var t=this.$el.find('[name="address"]').val();return!t||t.length<=0?null:{address:t,zoom:this.$el.find('[name="zoom"]').val(),width:this.$el.find('[name="width"]').val(),height:this.$el.find('[name="height"]').val()}},_safeData:function(t){var e={};return Object.keys(t).forEach(function(i){e[i]=encodeURIComponent(t[i])}),e},_reloadMap:function(){var t=this.$map||this.$el.find(".map");t.is(":visible")||t.show(),this.$el.hasClass("st--is-loading")||(this.loading(),t.css("opacity","0.7")),clearTimeout(this.inputTimeoutId),this.inputTimeoutId=setTimeout(function(){this.ready(),t.css("opacity","1"),t.css("background-image","url("+this._getGmapsStaticImage()+")")}.bind(this),this.inputTimeoutAmount)},_getGmapsLink:function(){return _.template(this.map_link,this._safeData(this.getData().data))},_getGmapsStaticImage:function(){return _.template(this.map_static_img,this._safeData(this.getData().data))}})):console.error("SirTrevor.Blocks.Map could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Spacer=SirTrevor.Block.extend({type:"spacer",title:function(){return i18n.t("blocks:spacer:title")},editorHTML:'<div class="st-control"><div class="st-icon st-icon-height"></div><div class="st-value-container"> <input class="st-value" name="height" type="range" value="5" units="vw" step="0.1" max="50" min="0"/></div><span class="st-output"></span></div>',loadData:function(t){this.$height=this.$height||this.$editor.find('[name="height"]'),this.$height.val(t.height),this.$height.attr("units",t.units)},onBlockRender:function(){this.$height=this.$height||this.$editor.find('[name="height"]'),this.$height.on("change input",function(t){var e=this.$(t.target),i=e.val();this.$(".st-output").html(i)}.bind(this)),this.$height.trigger("change")},_serializeData:function(){return{height:this.$height?this.$height.val():0,units:this.$height?this.$height.attr("units"):""}}})):console.error("SirTrevor.Blocks.Spacer could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.TextAlign=SirTrevor.Blocks.Text.extend({type:"text_align",alignable:!0})):console.error("SirTrevor.Blocks.TextAlign could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Widget=SirTrevor.Blocks.Text.extend({type:"widget",title:function(){return i18n.t("blocks:widget:title")},icon_name:"code",editorHTML:'<div class="st-widget-editor-container"><div class="editor"><span class="st-icon"></span><textarea name="text" class="st-required"></textarea></div><div style="display: none" class="preview"><pre><code class="lang-html"></code></pre></div></div>',loadData:function(t){this.loadPastedContent(t.text)},onBlockRender:function(){var t=this.$el.find("textarea"),e=t[0],i=this.$el.find(".preview"),n=e.offsetHeight-e.clientHeight;i.attr("title",i18n.t("blocks:widget:edit")),t.attr("placeholder",i18n.t("blocks:widget:hint")),t.on("keyup input",function(){t.css("height","auto").css("height",e.scrollHeight+n)})},onContentPasted:function(t){this.$el.find("textarea").val().length<=0&&this.loadPastedContent($(t.target).val())},loadPastedContent:function(t){t=t||"";var e=this.$el.find.bind(this.$el),i=e(".preview"),n=i.find("code"),o=e(".editor"),s=e("textarea"),r=o.find(".st-icon");s.val(t),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),n.html(t),hljs.highlightBlock(n[0]),r.hide(),o.hide(),i.show(),i.dblclick(function(){o.show(),i.hide(),s.trigger("input")})}})):console.error("SirTrevor.Blocks.Widget could not load because SirTrevor wasn't found")}(),function(){var t=SirTrevor.BlockMixins,e=SirTrevor.Block;e.prototype.availableMixins.push("alignable");var i={aligns:{left:!0,center:!0,justify:!0,right:!0},handler:function(t){this.getTextBlock().removeClass(function(t,e){return e.split(" ").filter(function(t){return/^st\-align-/.test(t)}).join(" ")}),this.getTextBlock().addClass("st-align-"+t)}};t.Alignable={mixinName:"Alignable",initializeAlignable:function(){(this.controllable===!0&&!this.$control_ui||!this.controllable)&&(this.controls=this.controls||{},this.withMixin(t.Controllable),this.controllable=!1),this.align_options=jQuery.extend(!0,{},i,this.align_options),Object.keys(this.align_options.aligns).forEach(function(t){var e=this.align_options.aligns[t];if(0!=e){var i=this.align_options.handler;if(e instanceof Function&&(i=e),!(i&&i instanceof Function))throw new Error("AlignableMixin: No valid handler function found for "+t);e===!0&&this.addUiControl("align-"+t,function(e){if(this._getData().align=t,i.bind(this)(t),e.originalEvent){console.log("raising block:aligned event");var n=jQuery.Event();n.originalEvent=e,n.target=this.$el,n.align=t,this.mediator.trigger("block:aligned",n)}}.bind(this))}}.bind(this));var e=this._getData();e&&e.align&&this.$control_ui.find('[class*="align-'+e.align+'"]').click()}}}();
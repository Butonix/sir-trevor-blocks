!function(){var t={en:{blocks:{button:{title:"Button",styles:{backgroundColor:"Background Color",borderWidth:"Border Width",borderColor:"Border Color",borderRadius:"Border Radius",width:"Width",height:"Height"},hint:{text:"¡Escribe aqui el texto de tu Boton!",href:"Write an email, phone number or web URL here"},accept:"Accept",cancel:"Cancel"},image_edit:{finish:"Confirm the crop for being able to save"},map:{title:"Map",hint:"Write an address here"},widget:{title:"Widget",hint:"Paste your external Widget html here"}}}};jQuery.extend(!0,SirTrevor.Locales,t)}(),function(){var t={es:{blocks:{button:{title:"Botón",styles:{backgroundColor:"Color de fondo",borderWidth:"Ancho del borde",borderColor:"Color del borde",borderRadius:"Radio del borde",width:"Ancho",height:"Alto"},hint:{text:"¡Escribe aqui el texto de tu Boton!",href:"Escribe aqui un email, un telefono o una web"},accept:"Aceptar",cancel:"Cancelar"},image_edit:{finish:"Confirma el recorte de la imagen para poder guardar"},map:{title:"Mapa",hint:"Escribe una direccion aquí"},spacer:{title:"Espacio en blanco"},widget:{title:"Widget",hint:"Pega el html de tu widget externo aquí"}}}};jQuery.extend(!0,SirTrevor.Locales,t)}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Button=SirTrevor.Block.extend({type:"button",title:function(){return i18n.t("blocks:button:title")},icon_name:"button",editorHTML:function(){return'<div class="st-editor"><div class="st-preview"><p class="st-required st-text-block" contenteditable="true"></p></div><div class="st-row"><div class="st-control"><div class="st-icon st-icon-link"></div><div class="st-input-container"> <input name="href" type="hidden"> <input name="user-href" type="text"></div></div></div><div class="st-row"><div class="st-column st-column-33"><div class="st-control"><div class="st-icon st-icon-color"></div><div class="st-input-container"> <input class="st-value" name="css-background-color" type="color" value="#00CA6B"></div></div></div><div class="st-column st-column-33"><div class="st-control"><div class="st-icon st-icon-color"></div><div class="st-input-container"> <input class="st-value" name="css-border-color" type="color" value="#4D4D4D"></div></div></div><div class="st-column st-column-33"><div class="st-control"><div class="st-icon st-icon-color"></div><div class="st-input-container"> <input class="st-value" name="css-color" type="color" value="#4D4D4D"></div></div></div></div><div class="st-row"><div class="st-column st-column-50"><div class="st-control"><div class="st-icon st-icon-width"></div><div class="st-input-container"> <input class="st-value" name="css-width" type="range" value="100" units="%" step="1" max="100" min="10"></div></div><div class="st-control"><div class="st-icon st-icon-height"></div><div class="st-input-container"> <input class="st-value" name="css-padding" type="range" value="1" units="em 0" step="0.1" max="5" min="0.2"></div></div></div><div class="st-column st-column-50"><div class="st-control"><div class="st-icon st-icon-border"></div><div class="st-input-container"> <input class="st-value" name="css-border-width" type="range" value="2" units="px" step="1" max="6" min="0"></div></div><div class="st-control"><div class="st-icon st-icon-radius"></div><div class="st-input-container"> <input class="st-value" name="css-border-radius" type="range" value="2" units="px" step="1" max="100" min="0"></div></div></div><div class="st-column st-column-50"><div class="st-control"><div class="st-icon st-icon-font-size"></div><div class="st-input-container"> <input class="st-value" name="css-font-size" type="range" value="2" units="em" step="0.1" max="5" min="0.2"></div></div></div><div class="st-column st-column-50"><div class="st-control"><div class="st-icon st-icon-font-family"></div><div class="st-input-container"> <select class="st-value" name="css-font-family"><option value="sans-serif">Sans Serif</option><option value="cursive">Cursive</option><option value="fantasy">Fantasy</option><option value="serif">Serif</option><option value="monospace">Monospace</option></select></div></div></div></div></div>'},onBlockRender:function(){this.$preview=this.$el.find(".st-preview"),this.$css=this.$editor.find('[name^="css-"]'),this.$editor.find('[type="color"]').spectrum({showInput:!0,preferredFormat:"hex",showButtons:!0,chooseText:i18n.t("blocks:button:accept"),cancelText:i18n.t("blocks:button:cancel")}),$(this.getTextBlockHTML()).text().length<=0&&this.setTextBlockHTML(i18n.t("blocks:button:hint:text")),this.$editor.find('[name="user-href"]').attr("placeholder",i18n.t("blocks:button:hint:href")).on("change input",this._onHrefChange.bind(this)),this.$css.on("change input",this._onCssPropertyChange.bind(this)),this.$css.filter('[name*="color"]').on("move.spectrum",this._onCssPropertyChange.bind(this)),this.$css.trigger("change")},loadData:function(t){this.setTextBlockHTML(t.text),Object.keys(t).forEach(function(i){var e=t[i],n=this.$el.find('[name="'+i+'"]');n.attr("units")&&n.attr("units").length>0&&(e=e.replace(n.attr("units"),"")),this.$el.find('[name="'+i+'"]').val(e)}.bind(this));var i=this.$el.find(".st-preview"),e=this.$el.find(".st-row");e.hide(),i.attr("contenteditable","false"),this.$control_ui.hide(),i.click(function(){e.show(),i.attr("contenteditable","true"),i.unbind("click"),this.$control_ui.show()}.bind(this))},_serializeData:function(){var t={};return this.hasTextBlock()&&(t.text=this.getTextBlockHTML(),t.format="html"),this.$("input, select").each(function(i,e){if(e.getAttribute("name")){var n=e.value;e.getAttribute("units")&&(n+=e.getAttribute("units")),t[e.getAttribute("name")]=n}}),t},_onHrefChange:function(t){var i=$(t.target),e=i.val(),n=this.$editor.find('[name="href"]');/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e)?n.val("mailto:"+e):/^\+?[0-9\-]+$/.test(e)?n.val("tel:"+e):/^(ftp|http|https):\/\/[^ "]+$/.test(e)?n.val(e):n.val("http://"+e)},_onCssPropertyChange:function(t,i){var e=$(t.target),n=e.attr("name").replace(/^css\-/,""),s=i?i.toString():e.val();i&&e.val(i),e.attr("units")&&e.attr("units").length>0&&(s+=e.attr("units")),n.split("_").forEach(function(t){this.$preview.css(t,s)},this)},alignable:!0,align_options:{aligns:{justify:!1},handler:function(t){"center"==t&&(t="none"),(this.$preview||this.$el.find(".st-preview")).css("float",t)}}})):console.error("SirTrevor.Blocks.Button could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.HeadingAlign=SirTrevor.Blocks.Heading.extend({type:"heading_align",alignable:!0})):console.error("SirTrevor.Blocks.HeaderAlign could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.ImageEdit=SirTrevor.Blocks.Image.extend({type:"image_edit",title:function(){return i18n.t("blocks:image:title")},cropTimeout:1e3,controllable:!0,controls:{save:function(){var t={name:this.filename+".png",folder:"img",base64content:this.$cropper("getCroppedCanvas").toDataURL(this.type)};this.resetErrors(),this.$editor.html($("<img>",{src:t.base64content})).show();var i=function(t){t&&void 0!==t.cause?this.setError(this.$inputs,t.cause):this.setError(this.$inputs,t)}.bind(this);$.ajax({method:"POST",url:SirTrevor.config.defaults.uploadUrl,data:t,beforeSend:function(){this.$control_ui.hide(),this.loading()}.bind(this),complete:function(){this.ready(),this.performValidations()}.bind(this)}).then(function(t){if("success"==t.result){this.setAndLoadData({file:{url:t.url}});var e="blocks:image_edit:uploaded",n=jQuery.Event(n);n.target=this.$editor.find(">img")[0],this.mediator.trigger(e,n)}else i(t)}.bind(this)).fail(i)}},validations:["_checkCropFinished"],_isImageUploaded:function(){var t=this._getData();return t&&t.file&&t.file.url.length>0?!/^data:image\/[a-z]{1,};base64/.test(t.file.url):!1},_checkCropFinished:function(){this.isEmpty()||this._isImageUploaded()||this.setError(this.$inputs,i18n.t("blocks:image_edit:finish"))},loadData:function(t){this.$editor.html($("<img>",{src:t.file.url})).show(),this.$control_ui.hide()},remove:function(){this.ajaxable&&this.resolveAllInQueue();var t=this._getData();if(this._isImageUploaded()){var i="block:image_edit:remove";this.mediator._events[i]&&this.mediator._events[i].length>0?this.mediator.trigger(i,t.file.url):$.ajax({method:"POST",url:SirTrevor.config.defaults.imageDeleteUrl,data:{url:t.file.url}})}this.$el.remove()},onBlockRender:function(){this.$dropzone.noDropArea().unbind("drop"),this.$inner.dropArea().bind("drop",this.__handleDrop.bind(this)),this.$inputs.find("button").bind("click",function(t){t.preventDefault()}),this.$inputs.find("input").on("change",function(t){this.onDrop(t.currentTarget)}.bind(this)),this.$control_ui.hide()},onDrop:function(t){var i=t.files[0],e="undefined"!=typeof URL?URL:"undefined"!=typeof webkitURL?webkitURL:null;if(/image/.test(i.type)){this.filename=i.name,this.type=i.type,this.$control_ui.show(),this.$inputs.hide(),this.$el.noDropArea(),this.$editor.html($("<img>",{src:e.createObjectURL(i)})).show(),this.loading();var n=null,s=this.$editor.find(">img");s.cropper({built:function(){this.$cropper=function(){return s.cropper.apply(s,arguments)},this.ready()}.bind(this),crop:function(t){if(n)clearTimeout(n);else{var i=jQuery.Event("crop:start");i.originalEvent=t,this.$el.triggerHandler(i,[this.$inputs.first()])}n=setTimeout(function(){n=null;var i=jQuery.Event("crop:finish");i.originalEvent=t,this.$el.triggerHandler(i,[this.$inputs.first()])}.bind(this),this.cropTimeout)}.bind(this)})}},isEmpty:function(){return this.$editor.find("img").length<=0||_.isEmpty(this._getData())},_serializeData:function(){var t=this.$editor.find("img").attr("src");return this.$cropper&&!/^http/.test(t)&&(t=this.$cropper("getCroppedCanvas").toDataURL(this.type)),t&&t.length>0?{file:{url:t}}:null},__handleDrop:function(t){t.preventDefault(),t=t.originalEvent;var i=$(t.target),e=this._toArray(t.dataTransfer.types);i.removeClass("st-dropzone--dragover"),e&&e.some(function(t){return this.valid_drop_file_types.includes(t)},this)&&this.onDrop(t.dataTransfer),SirTrevor.EventBus.trigger("block:content:dropped",this.blockID)},_toArray:function(t){if(Array.isArray(t))return t;for(var i=[],e=t.length>>>0;e--;)i[e]=t[e];return i}})):console.error("SirTrevor.Blocks.ImageEdit could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Map=SirTrevor.Block.extend({type:"map",title:function(){return i18n.t("blocks:map:title")},icon_name:"map",default_width:600,default_height:300,default_zoom:15,map_static_img:"https://maps.googleapis.com/maps/api/staticmap?size=<%= width %>x<%= height %>&center=<%= address %>&markers=|<%= address %>&zoom=<%= zoom %>&scale=2",map_link:"http://maps.google.com/maps?q=<%= address %>",editorHTML:function(){var t=$("<input>",{type:"text",name:"address",placeholder:i18n.t("blocks:map:hint")}),i=$("<input>",{type:"hidden",name:"zoom",value:this.default_zoom}),e=$("<input>",{type:"hidden",name:"width",value:this.default_width}),n=$("<input>",{type:"hidden",name:"height",value:this.default_height}),s=$("<div>",{"class":"map"}),o=$("<div>");return o.append(t),o.append(i),o.append(e),o.append(n),o.append(s),s.css({"border-radius":"5px","background-color":"#DDD","background-position":"center","background-size":"cover",height:this.default_height+"px",width:"100%"}),s.hide(),o.html()},inputTimeoutAmount:1e3,inputTimeoutId:null,onBlockRender:function(){this.$map=this.$el.find(".map"),this.$zoom=this.$el.find('[name="zoom"]');var t=function(){window.open(this._getGmapsLink())}.bind(this),i=function(t){if(this.$map.is(":hover")){t.preventDefault();var i=t.originalEvent,e=i.deltaY||i.wheelDelta;e>0?this.$zoom.val(Math.max(0,Number(this.$zoom.val())-1)):this.$zoom.val(Number(this.$zoom.val())+1),this._reloadMap()}}.bind(this);this.$editor.bind("keypress keydown keyup",function(t){13==t.keyCode&&t.preventDefault()}),this.$map.on("click",t),this.$editor.is(":visible")&&(this.$map.on("wheel mousewheel",i),this.$editor.on("keyup change",this._reloadMap.bind(this)))},loadData:function(t){Object.keys(t).forEach(function(i){this.$el.find('[name="'+i+'"]').val(t[i])}.bind(this)),this.$editor.hide(),this._reloadMap()},isEmpty:function(){return!(this.$el&&this.$el.find('[name="address"]').length>0&&this.$el.find('[name="address"]').val().length>0)},_serializeData:function(){var t=this.$el.find('[name="address"]').val();return!t||t.length<=0?null:{address:t,zoom:this.$el.find('[name="zoom"]').val(),width:this.$el.find('[name="width"]').val(),height:this.$el.find('[name="height"]').val()}},_safeData:function(t){var i={};return Object.keys(t).forEach(function(e){i[e]=encodeURIComponent(t[e])}),i},_reloadMap:function(){var t=this.$map||this.$el.find(".map");t.is(":visible")||t.show(),this.$el.hasClass("st--is-loading")||(this.loading(),t.css("opacity","0.7")),clearTimeout(this.inputTimeoutId),this.inputTimeoutId=setTimeout(function(){this.ready(),t.css("opacity","1"),t.css("background-image","url("+this._getGmapsStaticImage()+")")}.bind(this),this.inputTimeoutAmount)},_getGmapsLink:function(){return _.template(this.map_link,this._safeData(this.getData().data))},_getGmapsStaticImage:function(){return _.template(this.map_static_img,this._safeData(this.getData().data))}})):console.error("SirTrevor.Blocks.Map could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Spacer=SirTrevor.Block.extend({type:"spacer",title:function(){return i18n.t("blocks:spacer:title")},editorHTML:'<div class="st-control"><div class="st-icon st-icon-height"></div><div class="st-value-container"> <input class="st-value" name="height" type="range" value="5" units="vw" step="0.1" max="50" min="0" /></div><span class="st-output"></span></div>',loadData:function(t){this.$height=this.$height||this.$editor.find('[name="height"]'),this.$height.val(t.height),this.$height.attr("units",t.units)},onBlockRender:function(){this.$height=this.$height||this.$editor.find('[name="height"]'),this.$height.on("change input",function(t){var i=this.$(t.target),e=i.val();this.$(".st-output").html(e)}.bind(this)),this.$height.trigger("change")},_serializeData:function(){return{height:this.$height?this.$height.val():0,units:this.$height?this.$height.attr("units"):""}}})):console.error("SirTrevor.Blocks.Spacer could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.TextAlign=SirTrevor.Blocks.Text.extend({type:"text_align",alignable:!0})):console.error("SirTrevor.Blocks.TextAlign could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Widget=SirTrevor.Blocks.Text.extend({type:"widget",title:function(){return i18n.t("blocks:widget:title")},icon_name:"code",editorHTML:'<div class="st-widget-editor-container"><div class="editor"><span class="st-icon"></span><textarea></textarea></div><div style="display: none" class="preview"><pre><code class="lang-html"></code></pre></div></div>',loadData:function(t){this.loadPastedContent(t.text)},onBlockRender:function(){var t=this.$el.find("textarea"),i=t[0],e=i.offsetHeight-i.clientHeight;t.attr("placeholder",i18n.t("blocks:widget:hint")),t.on("keyup input",function(){t.css("height","auto").css("height",i.scrollHeight+e)})},onContentPasted:function(t){this.$el.find("textarea").val().length<=0&&this.loadPastedContent($(t.target).val())},loadPastedContent:function(t){t=t||"";var i=this.$el.find.bind(this.$el),e=i(".preview"),n=e.find("code"),s=i(".editor"),o=i("textarea"),r=i(".st-icon");o.val(t),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),n.html(t),hljs.highlightBlock(n[0]),r.hide(),s.hide(),e.show(),e.dblclick(function(){s.show(),e.hide(),o.trigger("input")})}})):console.error("SirTrevor.Blocks.Widget could not load because SirTrevor wasn't found")}(),function(){var t=SirTrevor.BlockMixins,i=SirTrevor.Block;i.prototype.availableMixins.push("alignable");var e={aligns:{left:!0,center:!0,justify:!0,right:!0},handler:function(t){this.getTextBlock().removeClass(function(t,i){return i.split(" ").filter(function(t){return/^st\-align-/.test(t)}).join(" ")}),this.getTextBlock().addClass("st-align-"+t)}};t.Alignable={mixinName:"Alignable",initializeAlignable:function(){(this.controllable===!0&&!this.$control_ui||!this.controllable)&&(this.controls=this.controls||{},this.withMixin(t.Controllable),this.controllable=!1),this.align_options=jQuery.extend(!0,{},e,this.align_options),Object.keys(this.align_options.aligns).forEach(function(t){var i=this.align_options.aligns[t];if(0!=i){var e=this.align_options.handler;if(i instanceof Function&&(e=i),!(e&&e instanceof Function))throw new Error("AlignableMixin: No valid handler function found for "+t);i===!0&&this.addUiControl("align-"+t,function(i){if(this._getData().align=t,e.bind(this)(t),i.originalEvent){console.log("raising block:aligned event");var n=jQuery.Event();n.originalEvent=i,n.target=this.$el,n.align=t,this.mediator.trigger("block:aligned",n)}}.bind(this))}}.bind(this));var i=this._getData();i&&i.align&&this.$control_ui.find('[class*="align-'+i.align+'"]').click()}}}();

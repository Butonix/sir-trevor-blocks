!function(){var t={en:{blocks:{button:{title:"Button",styles:{backgroundColor:"Background Color",borderWidth:"Border Width",borderColor:"Border Color",borderRadius:"Border Radius",width:"Width",height:"Height"},hint:{text:"¡Escribe aqui el texto de tu Boton!",href:"Write an email, phone number or web URL here"},accept:"Accept",cancel:"Cancel"},image_edit:{finish:"Confirm the crop for being able to save"},map:{title:"Map",hint:"Write an address here"},widget:{title:"Widget",hint:"Paste your external Widget html here"}}}};jQuery.extend(!0,SirTrevor.Locales,t)}(),function(){var t={es:{blocks:{button:{title:"Botón",styles:{backgroundColor:"Color de fondo",borderWidth:"Ancho del borde",borderColor:"Color del borde",borderRadius:"Radio del borde",width:"Ancho",height:"Alto"},hint:{text:"¡Escribe aqui el texto de tu Boton!",href:"Escribe aqui un email, un telefono o una web"},accept:"Aceptar",cancel:"Cancelar"},image_edit:{finish:"Confirma el recorte de la imagen para poder guardar"},map:{title:"Mapa",hint:"Escribe una direccion aquí"},widget:{title:"Widget",hint:"Pega el html de tu widget externo aquí"}}}};jQuery.extend(!0,SirTrevor.Locales,t)}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Button=SirTrevor.Block.extend({type:"button",title:function(){return i18n.t("blocks:button:title")},icon_name:"button",editorHTML:function(){return'<div class="st-editor"><div class="st-preview"><p class="st-required st-text-block" contenteditable="true"></p></div><div class="st-row"><div class="st-control"><div class="st-icon st-icon-link"></div><div class="st-input-container"> <input name="href" type="hidden"> <input name="user-href" type="text"></div></div></div><div class="st-row"><div class="st-column"><div class="st-control"><div class="st-icon st-icon-color"></div><div class="st-input-container"> <input class="st-value" name="css-background-color" type="color" value="#00CA6B"></div></div><div class="st-control"><div class="st-icon st-icon-width"></div><div class="st-input-container"> <input class="st-value" name="css-width" type="range" value="100" units="%" step="1" max="100" min="10"></div></div><div class="st-control"><div class="st-icon st-icon-height"></div><div class="st-input-container"> <input class="st-value" name="css-line-height" type="range" value="100" units="%" step="1" max="500" min="10"></div></div></div><div class="st-column"><div class="st-control"><div class="st-icon st-icon-color"></div><div class="st-input-container"> <input class="st-value" name="css-border-color" type="color" value="#4D4D4D"></div></div><div class="st-control"><div class="st-icon st-icon-border"></div><div class="st-input-container"> <input class="st-value" name="css-border-width" type="range" value="2" units="px" step="1" max="6" min="0"></div></div><div class="st-control"><div class="st-icon st-icon-radius"></div><div class="st-input-container"> <input class="st-value" name="css-border-radius" type="range" value="2" units="px" step="1" max="100" min="0"></div></div></div></div></div>'},onBlockRender:function(){this.$preview=this.$el.find(".st-preview"),this.$css=this.$editor.find('[name^="css-"]'),this.$editor.find('[type="color"]').spectrum({showInput:!0,preferredFormat:"hex",showButtons:!0,chooseText:i18n.t("blocks:button:accept"),cancelText:i18n.t("blocks:button:cancel")}),$(this.getTextBlockHTML()).text().length<=0&&this.setTextBlockHTML(i18n.t("blocks:button:hint:text")),this.$editor.find('[name="user-href"]').attr("placeholder",i18n.t("blocks:button:hint:href")).on("change input",this._onHrefChange.bind(this)),this.$css.on("change input",this._onCssPropertyChange.bind(this)),this.$css.filter('[name*="color"]').on("move.spectrum",this._onCssPropertyChange.bind(this)),this.$css.filter('[name="css-background-color"]').on("change input",this._onBackgroundColorChange.bind(this)),this.$css.filter('[name="css-background-color"]').on("move.spectrum",this._onBackgroundColorChange.bind(this)),this.$css.trigger("change")},loadData:function(t){this.setTextBlockHTML(t.text),Object.keys(t).forEach(function(e){this.$el.find('[name="'+e+'"]').val(t[e])}.bind(this)),this.$el.find(".st-control").hide(),this.$el.find(".st-text-block").attr("contenteditable","false")},_serializeData:function(){var t={};return this.hasTextBlock()&&(t.text=this.getTextBlockHTML(),t.format="html"),this.$("input").each(function(e,i){if(i.getAttribute("name")){var n=i.value;i.getAttribute("units")&&(n+=i.getAttribute("units")),t[i.getAttribute("name")]=n}}),this.$preview&&(t["css-color"]=this.$preview.css("color")),t},_onHrefChange:function(t){var e=$(t.target),i=e.val(),n=this.$editor.find('[name="href"]');/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(i)?n.val("mailto:"+i):/^\+?[0-9\-]+$/.test(i)?n.val("tel:"+i):n.val(i)},_onCssPropertyChange:function(t,e){var i=$(t.target),n=i.attr("name").replace(/^css\-/,""),s=e?e.toString():i.val();e&&i.val(e),i.attr("units")&&i.attr("units").length>0&&(s+=i.attr("units")),this.$preview.css(n,s)},_onBackgroundColorChange:function(t){this.$preview.css("color",this._getFontColor.bind(this)(t))},_getFontColor:function(t){var e=$(t.target).spectrum("get").toHex(),i=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2,2),16),s=parseInt(e.substr(4,2),16),o=(299*i+587*n+114*s)/1e3;return o>=128?"#000000":"#FFFFFF"}})):console.error("SirTrevor.Blocks.Button could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.ImageEdit=SirTrevor.Blocks.Image.extend({type:"image_edit",title:function(){return i18n.t("blocks:image:title")},cropTimeout:1e3,controllable:!0,controls:{save:function(){var t={name:this.__fixFilename(this.filename+".png"),folder:"img",base64content:this.$cropper("getCroppedCanvas").toDataURL()};this.resetErrors(),this.$editor.html($("<img>",{src:t.base64content})).show();var e=function(t){t&&void 0!==t.cause?this.setError(t.cause):this.setError(t)}.bind(this);$.ajax({method:"POST",url:SirTrevor.config.defaults.uploadUrl,data:t,beforeSend:function(){this.$control_ui.hide(),this.loading()}.bind(this),complete:function(){this.ready(),this.performValidations()}.bind(this)}).then(function(t){"success"==t.result?this.setAndLoadData({file:{url:t.url}}):e(t)}.bind(this)).fail(e)}},validations:["_checkCropFinished"],_isImageUploaded:function(){var t=this._getData();return t&&t.file&&t.file.url.length>0?!/^data:image\/png;base64/.test(t.file.url):!1},_checkCropFinished:function(){this._getData();this._isImageUploaded()||this.setError(this.$inputs,i18n.t("blocks:image_edit:finish"))},loadData:function(t){this.$editor.html($("<img>",{src:t.file.url})).show(),this.$control_ui.hide()},remove:function(){this.ajaxable&&this.resolveAllInQueue();var t=this._getData();if(this._isImageUploaded()){var e="block:image:remove";this.mediator._events[e]&&this.mediator._events[e].length>0?this.mediator.trigger("block:image:remove",t.file.url):$.ajax({method:"POST",url:SirTrevor.config.defaults.imageDeleteUrl,data:{url:t.file.url}})}this.$el.remove()},onBlockRender:function(){this.$inputs.find("button").bind("click",function(t){t.preventDefault()}),this.$inputs.find("input").on("change",function(t){this.onDrop(t.currentTarget)}.bind(this)),this.$control_ui.hide()},onDrop:function(t){var e=t.files[0],i="undefined"!=typeof URL?URL:"undefined"!=typeof webkitURL?webkitURL:null;if(/image/.test(e.type)){this.filename=e.name,this.$control_ui.show(),this.$inputs.hide(),this.$editor.html($("<img>",{src:i.createObjectURL(e)})).show(),this.loading();var n=null,s=this.$editor.find(">img");s.cropper({built:function(){this.$cropper=function(){return s.cropper.apply(s,arguments)},this.ready()}.bind(this),crop:function(t){if(n)clearTimeout(n);else{var e=jQuery.Event("crop:start");e.originalEvent=t,this.$el.triggerHandler(e,[this.$inputs.first()])}n=setTimeout(function(){n=null;var e=jQuery.Event("crop:finish");e.originalEvent=t,this.$el.triggerHandler(e,[this.$inputs.first()])}.bind(this),this.cropTimeout)}.bind(this)})}},isEmpty:function(){return this.$editor.find("img").length<=0},_serializeData:function(){var t=this.$editor.find("img").attr("src");return this.$cropper&&!/^http/.test(t)&&(t=this.$cropper("getCroppedCanvas").toDataURL()),t&&t.length>0?{file:{url:t}}:null}})):console.error("SirTrevor.Blocks.ImageEdit could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Map=SirTrevor.Block.extend({type:"map",title:function(){return i18n.t("blocks:map:title")},icon_name:"map",default_width:600,default_height:300,default_zoom:15,map_static_img:"https://maps.googleapis.com/maps/api/staticmap?size=<%= width %>x<%= height %>&center=<%= address %>&markers=|<%= address %>&zoom=<%= zoom %>&scale=2",map_link:"http://maps.google.com/maps?q=<%= address %>",editorHTML:function(){var t=$("<input>",{type:"text",name:"address",placeholder:i18n.t("blocks:map:hint")}),e=$("<input>",{type:"hidden",name:"zoom",value:this.default_zoom}),i=$("<input>",{type:"hidden",name:"width",value:this.default_width}),n=$("<input>",{type:"hidden",name:"height",value:this.default_height}),s=$("<div>",{"class":"map"}),o=$("<div>");return o.append(t),o.append(e),o.append(i),o.append(n),o.append(s),s.css({"border-radius":"5px","background-color":"#DDD","background-position":"center","background-size":"cover",height:this.default_height+"px",width:"100%"}),s.hide(),o.html()},inputTimeoutAmount:1e3,inputTimeoutId:null,onBlockRender:function(){this.$map=this.$el.find(".map"),this.$zoom=this.$el.find('[name="zoom"]');var t=function(){window.open(this._getGmapsLink())}.bind(this),e=function(t){if(this.$map.is(":hover")){t.preventDefault();var e=t.originalEvent,i=e.deltaY||e.wheelDelta;i>0?this.$zoom.val(Math.max(0,Number(this.$zoom.val())-1)):this.$zoom.val(Number(this.$zoom.val())+1),this._reloadMap()}}.bind(this);this.$editor.bind("keypress keydown keyup",function(t){13==t.keyCode&&t.preventDefault()}),this.$map.on("click",t),this.$editor.is(":visible")&&(this.$map.on("wheel mousewheel",e),this.$editor.on("keyup change",this._reloadMap.bind(this)))},loadData:function(t){Object.keys(t).forEach(function(e){this.$el.find('[name="'+e+'"]').val(t[e])}.bind(this)),this.$editor.hide(),this._reloadMap()},isEmpty:function(){return!(this.$el&&this.$el.find('[name="address"]').length>0&&this.$el.find('[name="address"]').val().length>0)},_serializeData:function(){var t=this.$el.find('[name="address"]').val();return!t||t.length<=0?null:{address:t,zoom:this.$el.find('[name="zoom"]').val(),width:this.$el.find('[name="width"]').val(),height:this.$el.find('[name="height"]').val()}},_safeData:function(t){var e={};return Object.keys(t).forEach(function(i){e[i]=encodeURIComponent(t[i])}),e},_reloadMap:function(){var t=this.$map||this.$el.find(".map");t.is(":visible")||t.show(),this.$el.hasClass("st--is-loading")||(this.loading(),t.css("opacity","0.7")),clearTimeout(this.inputTimeoutId),this.inputTimeoutId=setTimeout(function(){this.ready(),t.css("opacity","1"),t.css("background-image","url("+this._getGmapsStaticImage()+")")}.bind(this),this.inputTimeoutAmount)},_getGmapsLink:function(){return _.template(this.map_link,this._safeData(this.getData().data))},_getGmapsStaticImage:function(){return _.template(this.map_static_img,this._safeData(this.getData().data))}})):console.error("SirTrevor.Blocks.Map could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.TextAlign=SirTrevor.Blocks.Text.extend({controllable:!0,controls:{alignLeft:function(){}}})):console.error("SirTrevor.Blocks.TextAlign could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Widget=SirTrevor.Block.extend({type:"widget",title:function(){return i18n.t("blocks:widget:title")},icon_name:"code",pastable:!0,paste_options:{html:'<div class="st-widget-editor-container"><span class="st-icon"></span><textarea class="st-paste-block" placeholder="<%= i18n.t("blocks:widget:hint") %>"></textarea></div>'},_serializeData:function(){return{format:"html",text:this.$el.find("textarea").val()}},isEmpty:function(){return!(this.$el&&this.$el.find("textarea").length>0&&this.$el.find("textarea").val().length>0)},loadData:function(t){this.loadPastedContent(t.text)},onContentPasted:function(t){this.loadPastedContent($(t.target).val())},loadPastedContent:function(t){t=t||"",this.$el.find("textarea").val(t),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;");var e=$("<pre>"),i=$("<code>",{"class":"lang-html"});i.html(t),hljs.highlightBlock(i.get()[0]),e.append(i),this.$editor.html(e),this.$inputs.hide()}})):console.error("SirTrevor.Blocks.Widget could not load because SirTrevor wasn't found")}();
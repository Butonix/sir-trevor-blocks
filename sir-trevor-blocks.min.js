!function(){var t={en:{blocks:{button:{title:"Button",styles:{backgroundColor:"Background Color",borderWidth:"Border Width",borderColor:"Border Color",borderRadius:"Border Radius",width:"Width",height:"Height",italic:"Italic",bold:"Bold"},caption:"Caption",href:"Link",onclick:"On Click"},map:{title:"Map",hint:"Write an address here"},widget:{title:"Widget",hint:"Paste your external Widget html here"}}}};jQuery.extend(!0,SirTrevor.Locales,t)}(),function(){var t={es:{blocks:{button:{title:"Botón",styles:{backgroundColor:"Color de fondo",borderWidth:"Ancho del borde",borderColor:"Color del borde",borderRadius:"Radio del borde",width:"Ancho",height:"Alto",italic:"Cursiva",bold:"Negrita"},caption:"Texto",href:"Enlace",onclick:"On Click"},map:{title:"Mapa",hint:"Escribe una direccion aquí"},widget:{title:"Widget",hint:"Pega el html de tu widget externo aquí"}}}};jQuery.extend(!0,SirTrevor.Locales,t)}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Button=SirTrevor.Block.extend({type:"button",title:function(){return i18n.t("blocks:button:title")},icon_name:"button",cssProperties:{display:"block",textDecoration:"none",margin:"0 auto",border:"2px solid",textAlign:"center",backgroundColor:{label:function(){return i18n.t("blocks:button:styles:backgroundColor")},input:{type:"color"}},borderWidth:{label:function(){return i18n.t("blocks:button:styles:borderWidth")},input:{type:"range",min:0,max:6,step:1,units:"px"}},borderColor:{label:function(){return i18n.t("blocks:button:styles:borderColor")},input:{type:"color"}},borderRadius:{label:function(){return i18n.t("blocks:button:styles:borderRadius")},input:{type:"range",min:0,max:100,step:1,units:"px"}},width:{label:function(){return i18n.t("blocks:button:styles:width")},input:{type:"range",min:10,max:100,step:1,units:"%"}},lineHeight:{label:function(){return i18n.t("blocks:button:styles:height")},input:{type:"range",min:0,max:500,step:1,units:"%"}},fontStyle:{label:function(){return i18n.t("blocks:button:styles:italic")},input:{type:"checkbox",value:"italic"}},fontWeight:{label:function(){return i18n.t("blocks:button:styles:bold")},input:{type:"checkbox",value:"bold"}}},_namePrepend:"st-button",_cssInputNamePrepend:"css_",editorHTML:function(){var t=this,e=$("<div>",{"class":"st-button"}),i=$("<div>",{"class":"st-button-editor"}),n=$("<div>",{"class":"st-button-preview"}),o=[{property:"caption",text:i18n.t("blocks:button:caption")},{property:"href",text:i18n.t("blocks:button:href")},{property:"onclick",text:i18n.t("blocks:button:onclick")}];return o.forEach(function(e){var n=$("<div>");n.addClass(t._namePrepend+"-style"),n.addClass(t._namePrepend+"-style-"+e.property),n.append($("<input>",{type:"text",name:e.property,placeholder:e.text})),i.append(n)}),Object.keys(t.cssProperties).forEach(function(e){var n=$("<div>"),o=t.cssProperties[e];e=t._decamelize(e),n.addClass(t._namePrepend+"-style"),n.addClass(t._namePrepend+"-style-"+e),_.isObject(o)?Object.keys(o).forEach(function(i){var r=o[i];_.isFunction(r)&&(r=r());var a=$("<"+i+">");_.isObject(r)?(Object.keys(r).forEach(function(t){var e=r[t];"html"!=t?a.attr(t,e):a.html(e)}),(!a.attr("name")||a.attr("name").length<=0)&&a.attr("name",t._cssInputNamePrepend+e)):a.html(r),n.append(a)}):n.append($("<input>",{type:"hidden",name:t._cssInputNamePrepend+e,value:o})),i.append(n)}),e.append(i),t.$preview=e.append(n),e.html()},_getBackgroundColorForForegroundColor:function(t){t=t.substr(1);var e=parseInt(t.substr(0,2),16),i=parseInt(t.substr(2,2),16),n=parseInt(t.substr(4,2),16),o=(299*e+587*i+114*n)/1e3;return o>=128?"black":"white"},loadData:function(t){var e=this;delete t.text,delete t.format,Object.keys(t).forEach(function(i){var n=t[i];_.isObject(n)?Object.keys(n).forEach(function(t){var o=n[t],r='[class*="'+e._namePrepend+"-"+i+"-"+t+'"] > input',a=e.$editor.find(r);"range"==a.attr("type")?a.val(parseInt(o)):"checkbox"==a.attr("type")?a.prop("checked",a.val()==o):a.val(o)}):e.$editor.find('[name="'+i+'"]').val(n)}),e._renderPreview(e)()},onBlockRender:function(){this.$editor.on("change",this._renderPreview(this)),this.$editor.on("input",this._renderPreview(this))},_renderPreview:function(t){return function(e){var i=t.toHTML();t.$el.find(".st-button-preview").html(i)}},_decamelize:function(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()},_serializeData:function(){var t=this,e={};e.caption=t.$el.find('input[name="caption"]').val(),e.href=t.$el.find('input[name="href"]').val(),e.onclick=t.$el.find('input[name="onclick"]').val(),e.style={};var i=t.$el.find('input[name^="'+t._cssInputNamePrepend+'"]');return i.each(function(i,n){n=$(n);var o=new RegExp("^"+t._cssInputNamePrepend,"i"),r=n.attr("name"),a=n.attr("units"),s=r.replace(o,"");if(o.test(r)&&s.length>0){var l=n.val();isNaN(l)||(l+=a&&a.length>0?a:"px"),"checkbox"!=n.attr("type")&&"radio"!=n.attr("type")||n.is(":checked")||(l=""),e.style[s]=l}}),e.text=t.toHTML(e),e.format="html",e},toHTML:function(t){var e=this;t=t||e.getBlockData();var i=$("<a>");return i.attr("onclick",t.onclick),i.attr("href",t.href),i.html(t.caption),Object.keys(t.style).forEach(function(e){i.css(e,t.style[e])}),t.style["background-color"]&&i.css("color",e._getBackgroundColorForForegroundColor(t.style["background-color"])),i[0].outerHTML}})):console.error("SirTrevor.Blocks.Button could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.ImageEdit=SirTrevor.Blocks.Image.extend({title:function(){return i18n.t("blocks:image:title")},type:"image_edit",cropTimeout:1e3,loadData:function(t){this.$editor.html($("<img>",{src:t.file.url})).show()},onDrop:function(t){var e=t.files[0],i="undefined"!=typeof URL?URL:"undefined"!=typeof webkitURL?webkitURL:null;if(/image/.test(e.type)){this.$inputs.hide(),this.$editor.html($("<img>",{src:i.createObjectURL(e)})).show(),this.loading();var n=null,o=this.$editor.find(">img");o.cropper({built:function(){this.$cropper=function(){return o.cropper.apply(o,arguments)},this.ready()}.bind(this),crop:function(t){n?clearTimeout(n):SirTrevor.EventBus.trigger("image_edit:crop:start",[t]),n=setTimeout(function(){n=null,SirTrevor.EventBus.trigger("image_edit:crop:finish",[t])}.bind(this),this.cropTimeout)}.bind(this)})}},isEmpty:function(){return this.$editor.find("img").length<=0},_serializeData:function(){var t=null;return t=this.$cropper?this.$cropper("getCroppedCanvas").toDataURL():this.$editor.find("img").attr("src"),t&&t.length>0?{file:{url:t}}:null}})):console.error("SirTrevor.Blocks.ImageEdit could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Map=SirTrevor.Block.extend({type:"map",title:function(){return i18n.t("blocks:map:title")},icon_name:"map",default_width:600,default_height:300,default_zoom:15,map_static_img:"https://maps.googleapis.com/maps/api/staticmap?size=<%= width %>x<%= height %>&center=<%= address %>&markers=|<%= address %>&zoom=<%= zoom %>&scale=2",map_link:"http://maps.google.com/maps?q=<%= address %>",editorHTML:function(){var t=$("<input>",{type:"text",name:"address",placeholder:i18n.t("blocks:map:hint")}),e=$("<input>",{type:"hidden",name:"zoom",value:this.default_zoom}),i=$("<input>",{type:"hidden",name:"width",value:this.default_width}),n=$("<input>",{type:"hidden",name:"height",value:this.default_height}),o=$("<div>",{"class":"map"}),r=$("<div>");return r.append(t),r.append(e),r.append(i),r.append(n),r.append(o),o.css({"border-radius":"5px","background-color":"#DDD","background-position":"center","background-size":"cover",height:this.default_height+"px",width:"100%"}),o.hide(),r.html()},inputTimeoutAmount:1e3,inputTimeoutId:null,onBlockRender:function(){this.$map=this.$el.find(".map"),this.$zoom=this.$el.find('[name="zoom"]');var t=function(){window.open(this._getGmapsLink())}.bind(this),e=function(t){if(this.$map.is(":hover")){t.preventDefault();var e=t.originalEvent,i=e.deltaY||e.wheelDelta;i>0?this.$zoom.val(Math.max(0,Number(this.$zoom.val())-1)):this.$zoom.val(Number(this.$zoom.val())+1),this._reloadMap()}}.bind(this);this.$editor.bind("keypress keydown keyup",function(t){13==t.keyCode&&t.preventDefault()}),this.$map.on("click",t),this.$editor.is(":visible")&&(this.$map.on("wheel mousewheel",e),this.$editor.on("keyup change",this._reloadMap.bind(this)))},loadData:function(t){Object.keys(t).forEach(function(e){this.$el.find('[name="'+e+'"]').val(t[e])}.bind(this)),this.$editor.hide(),this._reloadMap()},isEmpty:function(){return!(this.$el&&this.$el.find('[name="address"]').length>0&&this.$el.find('[name="address"]').val().length>0)},_serializeData:function(){var t=this.$el.find('[name="address"]').val();return!t||t.length<=0?null:{address:t,zoom:this.$el.find('[name="zoom"]').val(),width:this.$el.find('[name="width"]').val(),height:this.$el.find('[name="height"]').val()}},_safeData:function(t){var e={};return Object.keys(t).forEach(function(i){e[i]=encodeURIComponent(t[i])}),e},_reloadMap:function(){var t=this.$map||this.$el.find(".map");t.is(":visible")||t.show(),this.$el.hasClass("st--is-loading")||(this.loading(),t.css("opacity","0.7")),clearTimeout(this.inputTimeoutId),this.inputTimeoutId=setTimeout(function(){this.ready(),t.css("opacity","1"),t.css("background-image","url("+this._getGmapsStaticImage()+")")}.bind(this),this.inputTimeoutAmount)},_getGmapsLink:function(){return _.template(this.map_link,this._safeData(this.getData().data))},_getGmapsStaticImage:function(){return _.template(this.map_static_img,this._safeData(this.getData().data))}})):console.error("SirTrevor.Blocks.Map could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.VideoNoDrag=SirTrevor.Blocks.Video.extend({droppable:!1})):console.error("SirTrevor.Blocks.VideoNoDrag could not load because SirTrevor wasn't found")}(),function(){"use strict";return SirTrevor?void(SirTrevor.Blocks.Widget=SirTrevor.Block.extend({type:"widget",title:function(){return i18n.t("blocks:widget:title")},icon_name:"code",pastable:!0,paste_options:{html:['<div class="st-widget-editor-container">','  <span class="st-icon"></span>','  <textarea class="st-paste-block" placeholder="<%= i18n.t("blocks:widget:hint") %>"></textarea>',"</div>"].join("\n")},_serializeData:function(){return{format:"html",text:this.$el.find("textarea").val()}},isEmpty:function(){return!(this.$el&&this.$el.find("textarea").length>0&&this.$el.find("textarea").val().length>0)},loadData:function(t){this.loadPastedContent(t.text)},onContentPasted:function(t){this.loadPastedContent($(t.target).val())},loadPastedContent:function(t){t=t||"",this.$el.find("textarea").val(t),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;");var e=$("<pre>"),i=$("<code>",{"class":"lang-html"});i.html(t),hljs.highlightBlock(i.get()[0]),e.append(i),this.$editor.html(e),this.$inputs.hide()}})):console.error("SirTrevor.Blocks.Widget could not load because SirTrevor wasn't found")}();